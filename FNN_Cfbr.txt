# Step a: Import packages
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
from tensorflow.keras.utils import to_categorical

# Step b: Load the data
train = pd.read_csv("train_data.csv")
test = pd.read_csv("test_data.csv")

print("Train shape:", train.shape)
print("Test shape:", test.shape)

# Step c: Separate features (X) and labels (y) using iloc
# Assuming first column = label, rest = pixels
x_train = train.iloc[:, 1:].values
y_train = train.iloc[:, 0].values

x_test = test.iloc[:, 1:].values
y_test = test.iloc[:, 0].values

# Step d: Normalize pixel values (0–255 → 0–1)
x_train = x_train / 255.0
x_test = x_test / 255.0

# Step e: Convert labels to one-hot
num_classes = len(np.unique(y_train))
y_train = to_categorical(y_train, num_classes)
y_test = to_categorical(y_test, num_classes)

# Step f: Show few sample images
plt.figure(figsize=(6,6))
for i in range(9):
    plt.subplot(3,3,i+1)
    plt.imshow(x_train[i].reshape(32,32,3))   # if CIFAR-10 (32x32x3)
    plt.title("Label: " + str(np.argmax(y_train[i])))
    plt.axis('off')
plt.show()

# Step g: Build a simple Feedforward Neural Network
model = Sequential([
    Dense(512, activation='relu', input_shape=(x_train.shape[1],)),
    Dense(256, activation='relu'),
    Dense(num_classes, activation='softmax')
])

# Step h: Compile model
model.compile(optimizer='adam', loss='categorical_crossentropy', metrics=['accuracy'])

# Step i: Train the model
history = model.fit(x_train, y_train, epochs=8, batch_size=128, validation_split=0.2)

# Step j: Evaluate on test data
loss, acc = model.evaluate(x_test, y_test)
print("Test Accuracy:", acc)
print("Test Loss:", loss)

# Step k: Plot training accuracy and loss
plt.figure(figsize=(12,5))
plt.subplot(1,2,1)
plt.plot(history.history['accuracy'], label='train')
plt.plot(history.history['val_accuracy'], label='val')
plt.title('Accuracy')
plt.legend()

plt.subplot(1,2,2)
plt.plot(history.history['loss'], label='train')
plt.plot(history.history['val_loss'], label='val')
plt.title('Loss')
plt.legend()
plt.show()
